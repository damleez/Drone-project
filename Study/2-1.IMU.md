IMU
===
### 0. MEMS(Micro-Electro-Mechanical Systems) 
#### - MEMS [개념](https://swiftcam.tistory.com/95)
- 센서의 기술이 발달함에 따라 기계식 센서를 반도체 안에 구현한 초소형 센서들을 말함
  - MEMS 중 주변에서 쉽게 사용할 수 있는 것이 IMU센서이며 IMU센서에는 가속도계, 각속도계, 지자계가 한 센서에 일체형으로 들어가 있음


### 1. IMU 정의
#### - IMU의 [개념](https://velog.io/@717lumos/Sensor-IMU%EC%9D%98-%EA%B0%9C%EB%85%90-%EB%B0%8F-%ED%99%9C%EC%9A%A9%EB%B2%95#7-ars%EC%99%80-ahrs-ins%EC%9D%98-%EC%B0%A8%EC%9D%B4)
- IMU(Inertial Measurement Unit) : 관성 측정 장치
  - 6축 : 가속도 센서(Acceleration Sensor), 각속도 센서(Gyroscope, 자이로스코프)로 이루어져 있음
  - 9축 : 일부는 지자기 센서(Magnetometer)도 포함

#### - 가속도 센서(Acceleration Sensor)
![image](https://user-images.githubusercontent.com/108650199/186550665-c1734d92-4520-43c2-b2ef-a78e09bdb098.png)

- 물체에 작용하는 가속력과 진동력, 충격력 등 동적 힘이 발생했을 때, 움직임의 변화에 따른 가속도의 변화(단위: m/s^2)를 순간적으로 감지
- 초기값을 계산할때 중력 가속도를 분해하여 얼마나 기울어졌는지를 측정하는데 사용
- 또한 센서에서 얻어지는 출력값인 가속도를 적분하여 물체의 진행 방향에 대한 속도를 계산할 수 있고, 이를 가공하면 물체의 위치를 알아냄

##### - 단점
  - 짧은 기간에 대한 오차는 작으나, 센서에서 얻은 가속도 값을 적분하므로 시간에 따라 오차가 누적되는 단점
  - 때문에 GPS와 결합하여 보정하는 방법이 대중적으로 사용

##### - 가속도 센서의 측정 방법
  - 가속도 센서는 비중력(specific force)을 측정

    ![image](https://user-images.githubusercontent.com/108650199/186554999-92b8c3cc-8377-45d5-aee0-85d8eaa8f983.png)

    - 비중력(Specific Force, g-force 혹은 mass-specific force)은 단위 질량 당 비중력 힘(non-gravitational force)이며, 비중력은 실제 힘이 아니라 가속도의 타입
      - 지상에서는 물체는 수직 하방으로 중력가속도만큼(-g) 힘을 받고 있음
      - 어느 쪽으로 기우는 등 자세가 변함에 따라 x와 y, z 축 가속도계가 서로 영향을 미치며 측정 가속도값이 변화
      - 만약 정지된 상태라면, 중력 방향으로 작용하는 힘을 계산하여 각 축의 방향으로 기울어진 각도를 계산할 수 있음
    - 하지만 위 예시 상황과는 달리 물체가 움직일 경우, 즉 중력 외 가속이 있는 경우에는 가속도 센서만으로는 정확한 기울기를 알 수 없음
    - 중력 가속도와 이동에 의한 가속도 값이 구분이 안되기 때문
  - 그래서 이를 보정하기 위해 각속도 센서(자이로스코프)를 이용


#### - 자이로스코프(Gyroscope)

![image](https://user-images.githubusercontent.com/108650199/186556084-a7963846-248a-4d01-80fc-0bae12efa75c.png)

- 자이로스코프는 각속도(rad/s)를 측정하며 시간당 몇도(degree)를 회전했는지가 필요할 때 사용
  - ❓ 각속도 : 특정 축을 기준으로 했을 때의 초당 회전 각도
    - EX ) 수평 자세로 정지 시 ω=0 deg/s이다. 10초간 50°가 기울어진다면 평균 각속도는 ω=5deg/s
    - 다시 기울어짐을 멈춰 50°를 유지한다면 ω=0 deg/s로 돌아옴
- 자이로스코프는 중력을 이용하여 코리올리 힘을 검출
  - ❓ 코리올리힘 : ‘회전체의 표면 위에서 운동하는 물체에 대해 운동 속도 방향에 수직으로 작용하는 힘’ 또는 ‘회전하는 계에서 느껴지는 관성력’
    - EX ) 지구의 자전, 세면대 배수구에서 물의 회전
- 중력이 가해질 때 진동 속도가 변하는 것을 각속도로 계산해, 질량과 진동 속도를 통해 값을 측정하여 검출

##### - 단점
  - 자이로스코프는 정지할 때 혹은 아주 짧은 시간에 움직일 때는 오차가 없지만 움직일 때는 측정되는 각속도가 노이즈 등에 의해 에러가 발생
  - 이 오차가 적분 시에 누적된다면 시간이 지날수록 누적오차가 매우 커져 물체가 기울어진 각도 값이 실제와는 차이
  - 이 오차의 보상을 위해 지자기 센서를 활용
  - 또한 자이로스코프는 온도에 따라 측정값이 변화하기도 하는데, 하여 일부 IMU에서는 온도 센서를 추가적으로 내장하여 이용해 오차를 보상

##### - 가속도 센서의 측정 방법
  - 자이로스코프는 종류에 따라 정확도와 크기, 출력 형태가 다양한데, 일반적으로 MEMS 자이로스코프가 있으며, 대부분 회전 각속도를 측정
  - 샘플링 시간(Δt)마다 회전 각속도를 측정한다면 (회전각) = (각속도 측정값) X (샘플링 시간)로 회전각을 구함
  - 이 원리에 입각해 각속도를 통해 최종적으로 물체가 기울어진 각도를 구하려면, 각속도를 측정의 전체 시간에 걸쳐 적분을 해야함
    - 가속도의 경우에도 마찬가지며 가속도를 적분해 속도의 변화량을 구함
  - 💥️ MEMS센서들은 주변 전자장비, 철 등에 영향을 받으므로 주의 💥️


#### - 지자기 센서(Magnetometer)

![image](https://user-images.githubusercontent.com/108650199/186551752-21f72921-0a0e-480f-bf61-5a930787afec.png)

- 지자기(magnet)를 측정하며 자북을 기준으로 자기선속의 세기를 측정하여 자북을 기준으로 얼마나 틀어졌는지를 측정
  - 지자기 센서에서 검출한 북을 자북이라고 하며 (북극점에서 조금 어긋나 있음), 이 자북에서의 각도를 상기 식으로 산출함으로써 방위를 간단히 앎
  - 물체가 바라보는 방향이 북쪽 방향과 정렬되어 지구의 자기력선과 일치할 때 센서의 측정값이 최댓값·최솟값을 가짐
  - 따라서 지자기 센서는 주변 전기장, 자기장의 유무에 따라 측정값이 달라질 수도 있으므로 주의
  - ❓ 자북, 진북, 편각
    - 나침반이 측정하는 북쪽, 자기장이 가리키는 북쪽(자북, Magnetic North)은 실제 지구의 북쪽(진북, True North)과 일치 X
    - 진북과 자북 축 사이의 각도를 편각(Declination)이라 함
    - 자북과 진북은 위도에 따라 일정하게 선형으로 변하므로, 물체의 현재 위도를 알면 편각은 보정이 가능


### 2. IMU로 Roll, Pitch, Yaw 구하기
- 🌟️ 가속도 센서로 x, y, z 진행방향 확보 후, 자이로센서로 각 회전단의 변화량을 측정, 지자기 센서는 오차를 보상 🌟️
- 자이로스코프를 이용해 물체의 자세를 알아내고 물체가 움직임에 따라 자세를 업데이트하려면, 초기 물체의 Roll과 Pitch, Yaw 각에 자이로스코프에서 계산된 회전각을 누적(적분)
- 앞서 본 바와 같이 Roll과 Pitch는 가속도 센서에서 간단히 구할 수 있으며 시간에 따라 적분할 필요가 없음
- 물론 온도나 타 잡음에 대한 오차가 있긴 하지만, 역시나 시간에 대한 값은 아님
- 반면 Yaw는 가속도 센서로 계산할 수 없어 자이로스코프에서 적분을 통해서만 구할 수 있으며 이 과정에서 누적오차가 발생
- 이 때문에 지자기 센서를 융합해 사용하고 칼만 필터(Kalman Filter)로 보정
- 자이로스코프는 정밀한 센서의 경우 금액이 매우 높기 때문에 타 센서와 융합해 사용하는 경우가 일반적
- 자이로스코프(각속도 센서)는 빠른 시간 내에 변위값을 측정하기 유리하나 적분 오차가 발생하고, 가속도 센서와 지자기 센서는 느리지만 절대각을 구할 수 있음
- 따라서 가속도 센서 및 지자기 센서와 자이로스코프는 서로 보완(Complementary) 관계라 할 수 있음
- 센서 값의 융합 과정에서 칼만 필터(Kalman Filter) 혹은 상호보완필터(상보필터, Complementary Filter)를 사용
